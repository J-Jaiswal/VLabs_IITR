<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <title>Virtual Labs</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
      name="viewport"
    />
    <!-- Bootstrap 3.3.6 -->
    <link href="../../bootstrap/css/bootstrap.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <!-- Theme style -->
    <link href="../../dist/css/AdminLTE.css" rel="stylesheet" />
    <!-- AdminLTE Skins -->
    <link href="../../dist/css/skins/_all-skins.min.css" rel="stylesheet" />
    <script>
      window.onload = function () {
        document.getElementById("procedure").className = "active treeview";
      };
    </script>

    <!-- ====== Responsive Enhancements (additive only) ====== -->
    <style>
      :root {
        --page-pad: 24px;
        --text: #1f2937;
        --headline: #111827;
        --border: #e5e7eb;
        --card: #fafafa;
        --eqbg: #f8fafc;
        --codebg: #eef2f7;
      }

      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: var(--page-pad);
        color: var(--text);
        background: #fff;
      }

      /* Fluid media by default (logos, figures, equations, etc.) */
      img {
        max-width: 100%;
        height: auto;
      }

      p,
      li {
        text-align: justify;
      }
      h1,
      h2,
      h3 {
        margin: 10px 0 6px;
        color: var(--headline);
      }

      .card {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 14px 16px;
        margin: 12px 0;
        background: var(--card);
      }
      .eq {
        background: var(--eqbg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 8px 10px;
        overflow: auto;
        margin: 8px 0;
      }
      code {
        background: var(--codebg);
        padding: 2px 6px;
        border-radius: 6px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
          "Liberation Mono", monospace;
      }
      .muted {
        color: #6b7280;
      }
      .hi {
        color: #0ea5e9;
        font-weight: 600;
      }

      /* Tables: keep your original styles, add mobile scroll behavior */
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        border: 1px solid var(--border);
        padding: 8px 10px;
        text-align: left;
      }
      th {
        background: #f3f4f6;
      }
      .table-wrap {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      ul,
      ol {
        margin-left: 18px;
      }

      /* Navbar brand image scaling (override fixed width inline) */
      .navbar .navbar-brand img {
        display: block;
        height: 50px;
        width: auto !important; /* override inline width:400px */
        max-width: 100%;
        margin-top: -15px;
      }

      /* Breadcrumbs: allow horizontal scroll on phones */
      .content-header .breadcrumb {
        white-space: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* ===== Tablet / Phone ===== */
      @media (max-width: 991px) {
        body {
          margin: 14px;
        }
        h1 {
          font-size: 1.32rem;
        }
        h2 {
          font-size: 1.14rem;
        }
        h3 {
          font-size: 1.04rem;
        }
        .card {
          padding: 12px;
        }

        /* Make AdminLTE sidebar an overlay drawer */
        .main-sidebar {
          position: fixed;
          top: 0;
          bottom: 0;
          left: -240px; /* hidden by default */
          width: 240px;
          max-width: 80vw;
          z-index: 1040;
          transition: left 0.25s ease;
        }
        .sidebar-open .main-sidebar {
          left: 0;
        }

        /* Dim background when sidebar is open */
        .sidebar-open .content-wrapper::before {
          content: "";
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.35);
          z-index: 1039;
        }

        /* Content spans full width */
        .content-wrapper,
        .right-side,
        .main-footer,
        .main-header .navbar {
          margin-left: 0 !important;
        }

        /* Navbar brand a tad smaller */
        .navbar .navbar-brand img {
          height: 40px;
          margin-top: -10px;
        }
      }

      /* ===== Small phones ===== */
      @media (max-width: 575px) {
        body {
          margin: 10px;
        }
        .card {
          padding: 10px;
        }
        code {
          display: inline-block;
          max-width: 100%;
          overflow-x: auto;
        }
        .content-header .breadcrumb {
          font-size: 12px;
        }
        .logo p {
          font-size: 0.95em !important;
        }
      }

      /* ===== Large screens: keep your original look ===== */
      @media (min-width: 1200px) {
        body {
          margin: var(--page-pad);
        }
      }

      /* stop page scroll when drawer is open */
      body.sidebar-open {
        overflow: hidden;
      }

      /* Real backdrop (more reliable than ::before pseudo element) */
      .drawer-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        z-index: 1039;
        display: none;
      }
      body.sidebar-open .drawer-backdrop {
        display: block;
      }
    </style>
  </head>
  <body class="hold-transition skin-blue sidebar-mini">
    <!--Navigation Bar-->
    <div class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <button
            class="navbar-toggle"
            data-target="#navbar-ex-collapse"
            data-toggle="collapse"
            type="button"
          >
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://iitb.ac.in">
            <span>
              <!-- keep original inline sizes; CSS overrides for responsiveness -->
              <img
                src="images/iitrLogo.png"
                style="margin-top: -15px; height: 50px; width: 400px"
              />
            </span>
          </a>
        </div>
        <div class="collapse navbar-collapse" id="navbar-ex-collapse"></div>
      </div>
    </div>

    <div class="wrapper">
      <header class="main-header">
        <!-- Logo -->
        <a
          class="logo"
          href="../index.html"
          style="
            background-color: #009dff;
            border-right: solid;
            border-right-color: #1261a0;
          "
        >
          <p align="center" style="font-size: 1em">Geophysics Lab</p>
        </a>
        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top" style="background-color: #009dff">
          <!-- Sidebar toggle button-->
          <!-- NOTE: removed data-toggle="offcanvas" to stop AdminLTE from hijacking -->
          <a class="sidebar-toggle" href="#" id="toggle_nav" role="button">
            <span class="sr-only">Toggle navigation</span>
          </a>
          <section class="content-header">
            <ol class="breadcrumb">
              <li>
                <a href="../index.html"
                  ><i class="fa fa-dashboard"></i>Geophysics Lab</a
                >
              </li>
              <li><a href="#">Finding location of an earthquake</a></li>
              <li class="active">Procedure</li>
            </ol>
          </section>
        </nav>
      </header>

      <!-- Left side column -->
      <aside class="main-sidebar" style="background-color: #1261a0">
        <section class="sidebar">
          <!-- search form -->
          <form action="#" class="sidebar-form" method="get">
            <div class="input-group"></div>
          </form>
          <!-- menu -->
          <ul class="sidebar-menu" style="background-color: #1261a0">
            <li class="treeview" id="aim">
              <a href="index.html" id="aim">
                <i class="fa fa-files-o" style="color: white"></i>
                <span style="color: white">Aim</span>
              </a>
            </li>
            <li class="treeview" id="theory">
              <a href="theory.html" id="theory">
                <i class="fa fa-files-o" style="color: white"></i>
                <span style="color: white">Theory</span>
              </a>
            </li>
            <li class="treeview" id="pretest">
              <a href="pretest.html" id="pretest">
                <i class="fa fa-files-o" style="color: white"></i>
                <span style="color: white">Pre Test</span>
              </a>
            </li>
            <li class="treeview" id="procedure">
              <a href="procedure.html" id="procedure">
                <i class="fa fa-files-o" style="color: white"></i>
                <span style="color: white">Procedure</span>
              </a>
            </li>
            <li class="treeview" id="simulation">
              <a href="simulation.html" id="simulation">
                <i class="fa fa-laptop" style="color: white"></i>
                <span style="color: white">Simulation</span>
                <span class="pull-right-container"> </span>
              </a>
            </li>
            <li class="treeview" id="posttest">
              <a href=" posttest.html" id="posttest">
                <i class="fa fa-files-o" style="color: white"> </i>
                <span style="color: white">Post Test</span>
                <span class="pull-right-container"> </span>
              </a>
            </li>
            <li class="treeview" id="ref">
              <a href="references.html" id="references">
                <i class="fa fa-files-o" style="color: white"></i>
                <span style="color: white">References</span>
                <span class="pull-right-container"> </span>
              </a>
            </li>
          </ul>
        </section>
      </aside>

      <div class="content-wrapper">
        <!-- Content Header -->
        <section class="content-header">
          <h1 align="center">Finding location of an earthquake</h1>
        </section>

        <!-- Main content -->
        <section class="content">
          <div class="card">
            <h2>UI Controls</h2>
            <ul style="margin: 0 0 0 18px; padding: 0; list-style: disc">
              <li>
                <b>Stations:</b> number of receivers to place when you click
                <b>Generate</b>. Use at least 4, and spread them around the
                source (not in a straight line).
              </li>
              <li>
                <b>Event (X, Y, Z):</b> the “real” earthquake used to generate
                synthetic picks.
              </li>
              <li>
                <b><code>v</code><sub>true</sub>:</b> wave speed used to create
                the synthetic data.
              </li>
              <li>
                <b><code>v</code><sub>start</sub>:</b> wave speed assumed by the
                solver and misfit map.
              </li>
              <li>
                <b><code>σ</code> (Noise):</b> level of random error added to
                the picks (in seconds).
              </li>
              <li>
                <b>Outlier:</b> adds one bad pick (Mild ≈ ±3σ, Strong ≈ ±6σ).
              </li>
              <li>
                <b><code>λ</code> (Damping):</b> controls stability of updates.
                Bigger λ = slower but stable; smaller λ = faster but may wobble.
              </li>
              <li>
                <b>Generate / Run / Reset:</b>
                <b>Generate</b> places stations and makes synthetic picks,
                <b>Run</b> solves for [x, y, z, t<sub>0</sub>, v],
                <b>Reset</b> clears everything and reloads defaults.
              </li>
            </ul>
          </div>

          <!-- 
          <div class="card">
            <h2>Things to test</h2>
            <ol>
              <li>
                <strong>Baseline:</strong> Good station spread,
                <code>v<sub>true</sub>=v<sub>start</sub></code
                >, small <code>σ</code>. You should see a centered low-error
                region and the RMS (average error) drops quickly.
              </li>

              <li>
                <strong>Velocity bias:</strong> Keep stations the same but make
                <code>v<sub>start</sub> ≠ v<sub>true</sub></code
                >. The low-error area moves, so the location shifts (bias) even
                if RMS looks small.
              </li>
              <li>
                <strong>Noise test:</strong> Increase <code>σ</code> to ~0.2–0.3
                s. RMS finishes higher, the estimate wiggles more, and
                uncertainty grows.
              </li>
              <li>
                <strong>Outlier test:</strong> Add a mild/strong outlier. Turn
                up <code>λ</code> until the solution becomes steady again.
              </li>
              <li>
                <strong>Geometry test:</strong> Regenerate until stations are
                almost in a line or clumped. Expect a stretched uncertainty
                shape and slower, less reliable convergence.
              </li>
            </ol>
          </div> -->

          <div class="card">
            <h2>Step-by-Step Workflow</h2>

            <!-- STEP 1 -->
            <div
              style="
                margin-bottom: 20px;
                padding: 14px;
                border: 1px solid #ccc;
                border-radius: 6px;
              "
            >
              <h3 style="margin-top: 0">1) Place Stations</h3>
              <p>
                Choose <b>Number of Stations</b> and click <b>Generate</b> to
                place a random network. You can also add, move, or remove
                stations directly on the map using the toggle options.
              </p>
              <p>
                Try regenerating until the stations surround the expected source
                area (a good spread).
              </p>
            </div>

            <!-- STEP 2 -->
            <div
              style="
                margin-bottom: 20px;
                padding: 14px;
                border: 1px solid #ccc;
                border-radius: 6px;
              "
            >
              <h3 style="margin-top: 0">
                2) Set the “True Event” and Starting Guess
              </h3>
              <p>
                Enter the true <b>Event (X, Y, Z)</b>, the velocity
                <b><code>v</code><sub>true</sub></b
                >, and the noise level <b><code>σ</code></b
                >. You can also enable an <b>Outlier</b>.
              </p>
              <p>
                Set <b><code>v</code><sub>start</sub></b> for the solver and
                misfit map. (Best to start with
                <code>v<sub>start</sub> = v<sub>true</sub></code
                >.)
              </p>
            </div>

            <!-- STEP 3 -->
            <div
              style="
                margin-bottom: 20px;
                padding: 14px;
                border: 1px solid #ccc;
                border-radius: 6px;
              "
            >
              <h3 style="margin-top: 0">
                3) Run the Inversion & Read the Outputs
              </h3>
              <p>Click <b>Run</b>. At each iteration the solver:</p>
              <ul style="margin: 6px 0 12px 20px">
                <li>
                  <b>Predicts</b> arrival times from the current guess [x, y, z,
                  t<sub>0</sub>, v].
                </li>
                <li>
                  <b>Computes</b> residuals (observed – predicted) and updates
                  RMS.
                </li>
                <li>
                  <b>Builds</b> a sensitivity matrix (Jacobian), whitens by σ,
                  and takes a damped Gauss–Newton step.
                </li>
                <li>
                  <b>Updates</b> the model until changes are small or maximum
                  iterations are reached.
                </li>
              </ul>

              <!-- OUTPUTS -->
              <div
                style="
                  margin-top: 12px;
                  padding: 12px;
                  border: 1px dashed #aaa;
                  border-radius: 6px;
                "
              >
                <h4 style="margin-top: 0">Outputs to Read</h4>
                <p>
                  <b>Arrivals Times Map:</b> shows observed arrival times at
                  each station as zig-zag impulse.
                </p>
                <p>
                  <b>Stations Map:</b> stations = triangles; true event = big
                  star; estimate = small star; starting guess = green dot;
                  iteration updates = blue dots; outlier station = amber ring.
                  Checkout the ellipse size also ( reduce its size by adjusting
                  noise and stations geometry)
                </p>
                <p>
                  <b>Misfit Map:</b> heatmap of errors for surface points (true
                  depth, fixed v<sub>start</sub>). Brighter = better fit. If
                  shifted, v<sub>start</sub> may be wrong.
                </p>
                <p>
                  <b>Convergence Plot:</b> RMS vs iteration. Should drop and
                  flatten near noise level. If unstable, increase λ or use
                  better geometry.
                </p>
                <p>
                  <b>Data Tables:</b> left = station times (clean, noisy,
                  outlier flag); right = model updates each iteration.
                </p>
              </div>
            </div>
          </div>
        </section>
        <!-- /.content -->
      </div>

      <footer class="main-footer">
        <h4 align="center">Lab contributed by IIT Roorkee</h4>
      </footer>
    </div>

    <!-- Tiny helper: robust sidebar toggle (desktop collapse + mobile drawer) -->
    <script>
      (function () {
        var toggle = document.getElementById("toggle_nav");
        var mql = window.matchMedia("(max-width: 991px)");

        // Create a real clickable backdrop once
        var backdrop = document.createElement("div");
        backdrop.className = "drawer-backdrop";
        document.body.appendChild(backdrop);

        function isMobile() {
          return mql.matches;
        }

        // Reconcile classes when crossing the breakpoint (prevents stuck states)
        function reconcileOnChange() {
          if (isMobile()) {
            // entering mobile: remove desktop collapse state
            document.body.classList.remove("sidebar-collapse");
          } else {
            // leaving mobile: close the mobile drawer if it was open
            document.body.classList.remove("sidebar-open");
          }
        }
        if (mql.addEventListener)
          mql.addEventListener("change", reconcileOnChange);
        else if (mql.addListener) mql.addListener(reconcileOnChange); // Safari/older

        if (toggle) {
          toggle.addEventListener("click", function (e) {
            e.preventDefault();
            if (isMobile()) {
              // slide-in drawer on small screens
              document.body.classList.toggle("sidebar-open");
            } else {
              // AdminLTE desktop collapse behavior
              document.body.classList.toggle("sidebar-collapse");
            }
          });
        }

        // Click backdrop to close (mobile)
        backdrop.addEventListener("click", function () {
          if (isMobile()) document.body.classList.remove("sidebar-open");
        });

        // Close when clicking outside sidebar (mobile)
        document.addEventListener(
          "click",
          function (e) {
            if (!isMobile()) return;
            if (!document.body.classList.contains("sidebar-open")) return;
            var sidebar = document.querySelector(".main-sidebar");
            if (
              sidebar &&
              !sidebar.contains(e.target) &&
              !e.target.closest("#toggle_nav")
            ) {
              document.body.classList.remove("sidebar-open");
            }
          },
          true
        ); // capture phase improves reliability on mobile

        // ESC to close mobile drawer
        document.addEventListener("keydown", function (e) {
          if (
            e.key === "Escape" &&
            document.body.classList.contains("sidebar-open")
          ) {
            document.body.classList.remove("sidebar-open");
          }
        });

        // Optional: close after clicking a menu link on mobile
        document.querySelectorAll(".sidebar-menu a").forEach(function (a) {
          a.addEventListener("click", function () {
            if (isMobile()) document.body.classList.remove("sidebar-open");
          });
        });
      })();
    </script>
  </body>
</html>

<!-- ./wrapper -->
<!-- jQuery 2.2.3 -->
<script src="../../plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<!-- Slimscroll -->
<script src="../../plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../../plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/app.min.js"></script>
